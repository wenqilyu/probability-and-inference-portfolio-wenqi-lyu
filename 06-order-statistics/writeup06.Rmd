---
title: "writeup06"
output: 
  html_document: 
    code_folding: hide
    toc: yes
    number_sections: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# the initial median function and plot

## Function

The initial function about median: begin with the median from a sample of N = 200 from the standard normal distribution. Write an R function that is the density function for the median in this sample. 

Here are those 3 functions:

```{r}
dorder <- function(x){
  100*choose(200,100)*
    (pnorm(x))^(100-1)*
    (1-pnorm(x))^(200-100)*
    dnorm(x)
}

x <- seq(-4,4,by=0.1)
plot(x,dnorm(x,0,1),type = "l",main = "Standard Normal Distribution")
plot(x,dorder(x),type = "l",main = "PDF of Median Order of Standard Normal Distribution")
```

```{r}
porder <- function(x){
   pbinom(100-1,200,pnorm(x,0,1),lower.tail = FALSE)
}
curve(porder(x),-1,1,xlab=parse(text="x[(100)]"),ylab=("Probability"),main = "CDF of Median Order of Standard Normal Distribution")
```

```{r}
porder1 <- function(x,n,k){
  pbinom(k-1,n,pnorm(x,0,1),lower.tail = FALSE)
}
qorder1 <- function(p, n, k){
  out <- p
  for (i in seq_along(p)) {
    out[i] <- uniroot(function(x){porder1(x,n,k)-p[i]},c(-100,100))$root
  }
  out
}

p <- seq(0.05,0.95,by=0.01)
plot(p,qorder1(p,200,100),type = "l",ylab=parse(text="x[(100)]"),xlab=("Probability"),main = "Quantile of the median")
```




## CDF and ECDF plot:

* red line is the CDF

```{r}
samp = NA
for (i in 1:1000) {
  data <- rnorm(200)
  samp[i] = median(data)
}

x = seq(-4,4,by=0.1)
plot(x,porder(x),type = "l",main = "CDF and ECDFof Order Statistics of Standard Normal Density",xlim = c(-0.3,0.3),col = "red")
plot(ecdf(samp),add = TRUE)
```

## Hist and PDF

```{r}
plot(x,dorder(x),type = "l",main = "PDF of Order Statistics of Standard Normal Density",xlim = c(-0.5,0.5),col = "red")
hist(samp,freq = FALSE,add = TRUE,breaks = 30,)
```

## QQPlot of Median

```{r}
p <- seq(0.05,0.95,by=0.01)
samp1 = NA
for (i in seq_along(p)) {
  data <- rnorm(200)
  samp1[i] = median(data)
}
x <- qorder1(p,n = 200,k = 100)
y <- quantile(samp1, probs = p)

plot(x,y)
abline(0,1)

```



# Modified function

## Function

* Modify the dorder, porder, and qorder functions so that the functions take a new parameter k (for the kt**h order statistic) so that the functions will work for any order statistic and not just the median.

```{r}
dorder1 <- function(x, n, k){
  k*choose(n,k)*
    (pnorm(x))^(k-1)*
    (1-pnorm(x))^(n-k)*
    dnorm(x)
}
```

```{r}
porder1 <- function(x,n,k){
  pbinom(k-1,n,pnorm(x,0,1),lower.tail = FALSE)
}
```

```{r}
qorder1 <- function(p, n, k){
  out <- p
  for (i in seq_along(p)) {
    out[i] <- uniroot(function(x){porder1(x,n,k)-p[i]},c(-100,100))$root
  }
  out
}
```

## QQPlot


```{r}
samp2 = NA
for (i in seq_along(p)) {
  data <- rnorm(200)
  samp2[i] = max(data)
}
x <- qorder1(p,n = 200,k = 200)
y <- quantile(samp2, probs = p)

plot(x,y)
abline(0,1)
```


# Modified the function again

## Function

* Modify the dorder, porder, and qorder functions so that the functions take new parameters dist and ... so that the functions will work for any continuous distribution that has d and p functions defined in R.

```{r}
dorder2 <- function(x, k, n, dist = "norm", ...){
  pf <- get(paste0("p",dist))
  df <- get(paste0("d",dist))
  
  k*
    choose(n,k)*
    pf(x, ...)^(k-1)*
    (1-pf(x, ...))^(n-k)*
    df(x, ...)
}

porder2 <- function(x, k, n, dist = "norm", ...){
  pf <- get(paste0("p",dist))
  pbinom(k-1, n, pf(x,...),lower.tail = FALSE)
}

qorder2 <- function(p, k, n, dist = "norm", ...){
  out <- p
  for (i in seq_along(p)) {
    out[i] <- uniroot(function(x){porder(x,k,n,dist,...) - p[i]},c(-100,100))$root
    
  }
  out
}

```

## CDF and PDF of the min of Standard Normal Distribution

```{r}
curve(dorder2(x,n=200,k=1,dist="norm"),-5,5,ylab=("Density"),main = "PDF of min of Standard Normal Distribution")

curve(porder2(x,n=200,k=1,dist="norm"),-5,5,ylab=("Probablity"),main = "CDF of min of Standard Normal Distribution")
```

