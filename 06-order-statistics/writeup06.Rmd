---
title: "writeup06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Questions
Q: Begin with the median from a sample of N = 200 from the standard normal distribution. Write an R function that is the density function for the median in this sample. Note that the 100th order statistic is approximately the median, and use the order statistic formula discussed in class. Generate a plot of the function.

```{r}
dorder <- function(x, n, k){
  k*choose(n,k)*
    (pnorm(x))^(k-1)*
    (1-pnorm(x))^(n-k)*
    dnorm(x)
}

x = seq(-4,4,by=0.1)
plot(x,dorder(x,n=200,k=100),type = "l",main = "PDF of Order Statistics of Standard Normal Density")
```
Q: Write an R function that is the probability function for the median in this sample. Use the order statistic formula discussed in class. Generate a plot of the function.
```{r}
porder <- function(x,n,k){
  pbinom(k-1,n,pnorm(x,0,1),lower.tail = FALSE)
}

curve(
  porder(x,n = 200,k = 100)
  , -4
  , 4
  , xlab = parse(text = "x[(100)]")
  , ylab = "Probability"
)

```
Q: Write an R function that is the quantile function for the median in this sample. (You have several options for how to write this function.) Generate a plot of the function.
```{r}
qorder <- function(p, n, k){
  out <- p
  for (i in seq_along(p)) {
    out[i] <- uniroot(function(x){porder(x,n,k)-p[i]},c(-100,100))$root
  }
  out
}

p <- seq(0.05,0.95,by = 0.01)
plot(p,qorder(p,n = 200,k = 100),type = "l")
```
Q: Simulate the sampling distribution for the median. Create a plot of the empirical CDF (ECDF). Overlay the plot of the ECDF with a plot of the CDF.

```{r}
samp = NA
for (i in 1:1000) {
  data <- rnorm(200)
  samp[i] = median(data)
}
plot(ecdf(samp),col = "red")
```


Q: Using the simulated sampling distribution from the previous question, create a histogram (on the density scale). Overlay the histogram with a plot of the density function.

```{r}
hist(samp,freq = FALSE)
```


Q: One very common way to compare a random sample to a theoretical candidate distribution is the QQ plot. It is created by ploting quantiles of the theoretical distribution on the x-axis and empirical quantiles from the sample on the y-axis.

If sample and theoretical quantiles come from the same distribution, then the plotted points will fall along the line y = x, approximately. Here are two examples when the sample and theoretical quantiles came from the same distribution.


random_sample <- rexp(200)
q_candidate <- qexp

x <- q_candidate((1:200)/200)
y <- quantile(random_sample, probs = (1:200)/200)

svg("./assets/exponential-qq.svg", width = 5, height = 3)
tgsify::plotstyle(style = upright)
plot(x,y, asp = 1)
abline(0,1)
dev.off()
random_sample <- rnorm(200)
q_candidate <- qnorm

x <- q_candidate((1:200)/200)
y <- quantile(random_sample, probs = (1:200)/200)

svg("./assets/normal-qq.svg", width = 5, height = 3)
tgsify::plotstyle(style = upright)
plot(x,y, asp = 1, xlab = "Theoretical quantile", ylab = "Sample quantile")
abline(0,1)
dev.off()